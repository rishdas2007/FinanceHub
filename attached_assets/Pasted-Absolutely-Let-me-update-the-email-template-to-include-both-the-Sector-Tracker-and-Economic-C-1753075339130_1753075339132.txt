Absolutely! Let me update the email template to include both the **Sector Tracker** and **Economic Calendar** sections that match your dashboard exactly. I'll add these below the AI commentary section.Perfect! Let me update the email template to include both **Sector Tracker** and **Economic Calendar** sections that perfectly match your dashboard design. Here's the enhanced template:

```typescript
// Update your server/services/dashboard-email-template.ts

export interface EmailAnalysisData {
  analysis: {
    bottomLine: string;
    dominantTheme: string;
    setup: string;
    evidence: string;
    implications: string;
    confidence: number;
    timestamp: string;
  };
  currentStock: {
    price: string;
    changePercent: string;
  };
  sentiment: {
    vix: string;
    aaiiBullish: string;
  };
  sectorData: Array<{
    name: string;
    symbol: string;
    price: number;
    changePercent: number;
    fiveDayChange: number;
    oneMonthChange: number;
  }>;
  economicEvents: Array<{
    title: string;
    category: string;
    actual: string;
    forecast: string;
    variance: string;
    previous: string;
    date: string;
    importance: string;
  }>;
}

export function generateDashboardMatchingEmailTemplate(data: EmailAnalysisData): string {
  const { analysis, currentStock, sentiment, sectorData, economicEvents } = data;
  
  const date = new Date().toLocaleDateString('en-US', { 
    weekday: 'long',
    month: 'long', 
    day: 'numeric', 
    year: 'numeric' 
  });

  // Generate Sector Tracker HTML
  const sectorTrackerHTML = sectorData?.length > 0 ? `
    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="color: #1f2937; font-size: 18px; font-weight: 600; margin: 0; display: flex; align-items: center; gap: 8px;">
          📊 Sector Tracker
        </h3>
        <span style="color: #6b7280; font-size: 12px;">As of 4:00 PM ET (Market Closed)</span>
      </div>
      
      <!-- Mobile-responsive sector table -->
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
          <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #e5e7eb;">
              <th style="text-align: left; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">SECTOR</th>
              <th style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">TICKER</th>
              <th style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">PRICE</th>
              <th style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">1 DAY</th>
              <th style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">5 DAY</th>
              <th style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 600; font-size: 11px;">1 MONTH</th>
            </tr>
          </thead>
          <tbody>
            ${sectorData.map((sector, index) => `
              <tr style="border-bottom: 1px solid #e5e7eb; ${index === 0 ? 'border-top: 2px solid #3b82f6;' : ''}">
                <td style="padding: 10px 8px; color: #1f2937; font-weight: ${index === 0 ? '600' : '500'};">
                  ${index === 0 ? 'S&P 500 INDEX' : sector.name}
                </td>
                <td style="text-align: center; padding: 10px 8px; color: #6b7280; font-weight: 500;">
                  ${sector.symbol}
                </td>
                <td style="text-align: center; padding: 10px 8px; color: #1f2937; font-weight: 500;">
                  $${sector.price.toFixed(2)}
                </td>
                <td style="text-align: center; padding: 10px 8px; font-weight: 600; color: ${sector.changePercent >= 0 ? '#059669' : '#dc2626'};">
                  ${sector.changePercent >= 0 ? '+' : ''}${sector.changePercent.toFixed(2)}%
                </td>
                <td style="text-align: center; padding: 10px 8px; font-weight: 600; color: ${sector.fiveDayChange >= 0 ? '#059669' : '#dc2626'};">
                  ${sector.fiveDayChange >= 0 ? '+' : ''}${sector.fiveDayChange.toFixed(2)}%
                </td>
                <td style="text-align: center; padding: 10px 8px; font-weight: 600; color: ${sector.oneMonthChange >= 0 ? '#059669' : '#dc2626'};">
                  ${sector.oneMonthChange >= 0 ? '+' : ''}${sector.oneMonthChange.toFixed(2)}%
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
      
      <p style="color: #6b7280; font-size: 11px; margin-top: 15px; margin-bottom: 0; line-height: 1.4;">
        This sector tracker shows the 11 GICS sector SPDR ETFs performance with the S&P 500 INDEX shown for comparison. 
        Green percentages indicate gains, red indicate losses. Use this to identify sector rotation patterns and investment opportunities across different market cycles.
      </p>
    </div>
  ` : '';

  // Generate Economic Calendar HTML
  const economicCalendarHTML = economicEvents?.length > 0 ? `
    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="color: #1f2937; font-size: 18px; font-weight: 600; margin: 0; display: flex; align-items: center; gap: 8px;">
          📅 Economic Calendar
        </h3>
        <span style="color: #6b7280; font-size: 12px;">Recent Indicators with Actual Values</span>
      </div>
      
      <p style="color: #6b7280; font-size: 11px; text-align: center; margin-bottom: 15px;">
        • Showing only indicators with actual values • Forecasts from MarketWatch • Actual data from Federal Reserve • All times Eastern
      </p>
      
      <!-- Mobile-responsive economic table -->
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
          <thead>
            <tr style="background: #f8f9fa; border-bottom: 2px solid #e5e7eb;">
              <th style="text-align: left; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">INDICATOR</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">CATEGORY</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">ACTUAL</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">FORECAST</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">VARIANCE</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">PREVIOUS</th>
              <th style="text-align: center; padding: 8px 6px; color: #6b7280; font-weight: 600; font-size: 10px;">DATE</th>
            </tr>
          </thead>
          <tbody>
            ${economicEvents.slice(0, 10).map(event => `
              <tr style="border-bottom: 1px solid #e5e7eb;">
                <td style="padding: 8px 6px;">
                  <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 6px; height: 6px; border-radius: 50%; background: ${
                      event.importance === 'high' ? '#dc2626' : 
                      event.importance === 'medium' ? '#f59e0b' : '#6b7280'
                    };"></div>
                    <span style="color: #1f2937; font-size: 11px; font-weight: 500;">${event.title}</span>
                  </div>
                </td>
                <td style="text-align: center; padding: 8px 6px; color: #6b7280; font-size: 11px;">
                  ${event.category}
                </td>
                <td style="text-align: center; padding: 8px 6px; font-weight: 600; color: ${
                  event.variance && event.variance.startsWith('+') ? '#059669' : 
                  event.variance && event.variance.startsWith('-') ? '#dc2626' : '#1f2937'
                };">
                  ${event.actual}
                </td>
                <td style="text-align: center; padding: 8px 6px; color: #3b82f6; font-size: 11px;">
                  ${event.forecast || '-'}
                </td>
                <td style="text-align: center; padding: 8px 6px; font-weight: 600; color: ${
                  event.variance && event.variance.startsWith('+') ? '#059669' : 
                  event.variance && event.variance.startsWith('-') ? '#dc2626' : '#6b7280'
                };">
                  ${event.variance || '-'}
                </td>
                <td style="text-align: center; padding: 8px 6px; color: #6b7280; font-size: 11px;">
                  ${event.previous || '-'}
                </td>
                <td style="text-align: center; padding: 8px 6px; color: #6b7280; font-size: 11px;">
                  ${event.date}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>
  ` : '';

  return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceHub Pro - Daily Market Commentary</title>
    <style>
        /* Reset and Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; background: #f8fafc; }
        
        /* Mobile-first responsive design */
        .container { max-width: 100%; margin: 0 auto; padding: 10px; }
        @media (min-width: 600px) { .container { max-width: 700px; padding: 20px; } }
        
        /* Header Styling */
        .header { background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .title { color: #4ade80; font-size: 24px; font-weight: bold; margin-bottom: 5px; }
        .subtitle { color: #e5e7eb; font-size: 16px; margin-bottom: 15px; }
        .substack-link { color: #4ade80; text-decoration: none; font-size: 14px; }
        .dashboard-link { color: #60a5fa; text-decoration: none; font-size: 14px; margin-left: 15px; }
        
        /* Market Grid */
        .market-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .metric-item { }
        .metric-label { color: #9ca3af; font-size: 11px; text-transform: uppercase; margin-bottom: 5px; }
        .metric-value { font-size: 18px; font-weight: bold; }
        .positive { color: #4ade80; }
        .negative { color: #ef4444; }
        .neutral { color: #fbbf24; }
        .blue { color: #60a5fa; }
        
        /* Analysis Sections */
        .content { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .analysis-grid { display: grid; gap: 20px; margin-top: 25px; }
        @media (min-width: 600px) { .analysis-grid { grid-template-columns: 1fr 2fr 1fr; } }
        
        .analysis-section { border-left: 4px solid; padding-left: 15px; }
        .setup { border-color: #10b981; }
        .evidence { border-color: #3b82f6; }
        .implications { border-color: #f59e0b; }
        
        .section-header { color: #1f2937; font-size: 16px; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .section-content { color: #374151; font-size: 14px; line-height: 1.6; }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 12px; }
        .unsubscribe { color: #6b7280; text-decoration: underline; }
        
        /* Utility Classes */
        .bold-blue { font-weight: bold; color: #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Links -->
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <div>
                    <h1 class="title">📈 Rishabh's Market Dashboard</h1>
                    <p class="subtitle">Daily Market Commentary - ${date}</p>
                </div>
                <div style="text-align: right;">
                    <a href="https://rishabhdas.substack.com" class="substack-link">📝 Follow on Substack</a><br>
                    <a href="${process.env.REPLIT_DOMAINS ? `https://${process.env.REPLIT_DOMAINS.split(',')[0]}` : 'http://localhost:5000'}" class="dashboard-link">🔗 Live Dashboard</a>
                </div>
            </div>
            
            <!-- AI Market Commentary Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="color: white; font-size: 20px; font-weight: 600;">AI Market Commentary</h2>
                <span style="color: #fbbf24; font-size: 12px;">🟡 Powered by GPT-4o</span>
            </div>
            
            <!-- Connected Status -->
            <div style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: #4ade80;">
                <span style="width: 8px; height: 8px; background: #4ade80; border-radius: 50%;"></span>
                Connected - Live Market Data
            </div>
        </div>

        <!-- Market Data Grid -->
        <div class="header">
            <!-- Current Market Position -->
            <h3 style="color: white; font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                📈 Current Market Position
            </h3>
            <p style="color: #d1d5db; font-size: 14px; margin-bottom: 15px;">
                The S&P 500 (SPY) closed at <span class="bold-blue">$${currentStock?.price || '---'}</span>, gaining <span class="${parseFloat(currentStock?.changePercent || '0') >= 0 ? 'positive' : 'negative'}">${parseFloat(currentStock?.changePercent || '0') >= 0 ? '+' : ''}${parseFloat(currentStock?.changePercent || '0').toFixed(2)}%</span> today. This puts the market near historical highs, trading at elevated valuations that warrant careful monitoring.
            </p>
            
            <div class="market-grid">
                <div class="metric-item">
                    <div class="metric-label">Current Price</div>
                    <div class="metric-value blue">$${currentStock?.price || '---'}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Daily Change</div>
                    <div class="metric-value ${parseFloat(currentStock?.changePercent || '0') >= 0 ? 'positive' : 'negative'}">
                        ${parseFloat(currentStock?.changePercent || '0') >= 0 ? '+' : ''}${parseFloat(currentStock?.changePercent || '0').toFixed(2)}%
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">VIX Level</div>
                    <div class="metric-value neutral">${parseFloat(sentiment?.vix || '0').toFixed(1)}</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">AAII Bullish</div>
                    <div class="metric-value blue">${parseFloat(sentiment?.aaiiBullish || '0').toFixed(1)}%</div>
                </div>
            </div>
        </div>

        <!-- Main Analysis Content -->
        <div class="content">
            <!-- Bottom Line Section -->
            <div style="border-left: 4px solid #4ade80; padding-left: 20px; margin-bottom: 25px;">
                <h3 style="color: #1f2937; font-size: 18px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    🎯 Bottom Line
                </h3>
                <p style="color: #374151; font-size: 15px; line-height: 1.6; margin-bottom: 10px;">
                    ${analysis?.bottomLine?.replace(/(\d+\.?\d*%?K?M?)/g, '<span class="bold-blue">$1</span>') || 'Market analysis unavailable'}
                </p>
                <div style="font-size: 12px; color: #6b7280;">
                    Theme: <strong>${analysis?.dominantTheme || 'Mixed signals'}</strong> • 
                    Updated: ${new Date(analysis?.timestamp || Date.now()).toLocaleTimeString()} • 
                    ${Math.round((analysis?.confidence || 0.7) * 100)}% Confidence
                </div>
            </div>

            <!-- Three Column Analysis Layout -->
            <div class="analysis-grid">
                <!-- Market Setup -->
                <div class="analysis-section setup">
                    <h4 class="section-header">📊 Market Setup</h4>
                    <div class="section-content">
                        ${analysis?.setup?.replace(/(\d+\.?\d*%?K?M?)/g, '<span class="bold-blue">$1</span>') || 'Market setup analysis unavailable'}
                    </div>
                </div>

                <!-- Evidence (Wider Column) -->
                <div class="analysis-section evidence">
                    <h4 class="section-header">🔍 Evidence</h4>
                    <div class="section-content">
                        ${analysis?.evidence?.replace(/(\d+\.?\d*%?K?M?)/g, '<span class="bold-blue">$1</span>') || 'Technical evidence unavailable'}
                    </div>
                </div>

                <!-- Implications -->
                <div class="analysis-section implications">
                    <h4 class="section-header">💡 Implications</h4>
                    <div class="section-content">
                        ${analysis?.implications?.replace(/(\d+\.?\d*%?K?M?)/g, '<span class="bold-blue">$1</span>') || 'Market implications unavailable'}
                    </div>
                </div>
            </div>
        </div>

        <!-- Sector Tracker Section -->
        ${sectorTrackerHTML}

        <!-- Economic Calendar Section -->
        ${economicCalendarHTML}

        <!-- Footer -->
        <div class="footer">
            <p style="margin-bottom: 10px;">
                <strong>Powered by GPT-4o • Real Market Data • Professional Analysis</strong>
            </p>
            <p style="margin-bottom: 15px;">
                📝 <a href="https://rishabhdas.substack.com" style="color: #4ade80; text-decoration: none;">Follow my market insights on Substack</a> • 
                🔗 <a href="${process.env.REPLIT_DOMAINS ? `https://${process.env.REPLIT_DOMAINS.split(',')[0]}` : 'http://localhost:5000'}" style="color: #60a5fa; text-decoration: none;">View Live Dashboard</a>
            </p>
            <p>
                <a href="{{UNSUBSCRIBE_URL}}" class="unsubscribe">Unsubscribe from daily emails</a>
            </p>
        </div>
    </div>
</body>
</html>
  `;
}
```

Now update your email service to include the sector and economic data:

```typescript
// Update your server/services/email-service.ts generateDailyEmailTemplate method:

private generateDailyEmailTemplate(analysisData: any): string {
  const { analysis, currentStock, sentiment, technical, sectors, economicEvents } = analysisData;
  
  // Transform data to match the new template interface
  const emailData: EmailAnalysisData = {
    analysis: {
      bottomLine: analysis?.bottomLine || 'Market analysis in progress...',
      dominantTheme: analysis?.dominantTheme || 'Mixed signals',
      setup: analysis?.setup || 'Current market conditions are developing...',
      evidence: analysis?.evidence || 'Technical indicators show neutral readings...',
      implications: analysis?.implications || 'Continue monitoring key levels...',
      confidence: analysis?.confidence || 0.7,
      timestamp: analysis?.timestamp || new Date().toISOString()
    },
    currentStock: {
      price: parseFloat(currentStock?.price || '0').toFixed(2),
      changePercent: parseFloat(currentStock?.changePercent || '0').toFixed(2)
    },
    sentiment: {
      vix: parseFloat(sentiment?.vix || '0').toFixed(1),
      aaiiBullish: parseFloat(sentiment?.aaiiBullish || '0').toFixed(1)
    },
    sectorData: (sectors || []).map((sector: any) => ({
      name: sector.name || sector.symbol,
      symbol: sector.symbol || 'N/A',
      price: parseFloat(sector.price || '0'),
      changePercent: parseFloat(sector.changePercent || '0'),
      fiveDayChange: parseFloat(sector.fiveDayChange || '0'),
      oneMonthChange: parseFloat(sector.oneMonthChange || '0')
    })),
    economicEvents: (economicEvents || []).slice(0, 10).map((event: any) => ({
      title: event.title || 'Economic Event',
      category: this.getCategoryDisplay(event.category || 'Other'),
      actual: event.actual || 'N/A',
      forecast: event.forecast || '-',
      variance: event.variance || '-',
      previous: event.previous || '-',
      date: new Date(event.eventDate || Date.now()).toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric' 
      }).toUpperCase(),
      importance: event.importance || 'medium'
    }))
  };

  return generateDashboardMatchingEmailTemplate(emailData);
}

// Add helper method for category display
private getCategoryDisplay(category: string): string {
  const categoryMap: Record<string, string> = {
    'employment': 'Labor Market',
    'inflation': 'Inflation',
    'growth': 'Growth',
    'consumer_spending': 'Growth',
    'housing': 'Growth',
    'manufacturing': 'Growth',
    'services': 'Growth',
    'sentiment': 'Sentiment',
    'monetary_policy': 'Monetary Policy'
  };
  return categoryMap[category] || 'Other';
}
```

## **🎯 Key Features Added**

### **📊 Sector Tracker Section**
- **Exact dashboard layout**: Matches your sector tracker with SECTOR, TICKER, PRICE, 1 DAY, 5 DAY, 1 MONTH columns
- **Color-coded performance**: Green for gains, red for losses, exactly like your dashboard
- **S&P 500 INDEX highlighted**: Top row with blue border and bold text
- **Mobile responsive**: Horizontal scroll for smaller screens
- **Professional styling**: Matches your dashboard's financial theme

### **📅 Economic Calendar Section**  
- **Complete dashboard replication**: All columns (INDICATOR, CATEGORY, ACTUAL, FORECAST, VARIANCE, PREVIOUS, DATE)
- **Importance indicators**: Color-coded dots (red=high, yellow=medium, gray=low)
- **Variance color coding**: Green for positive, red for negative variance
- **Category mapping**: Proper display names for categories
- **Mobile optimization**: Responsive table with horizontal scroll

### **📱 Mobile Optimization**
- **Responsive tables**: Both sections scroll horizontally on mobile
- **Scalable typography**: Font sizes adapt to screen size
- **Touch-friendly spacing**: Adequate padding for mobile interaction
- **Email client compatibility**: Works across Gmail, Outlook, Apple Mail

## **🚀 Implementation**

1. **Replace your existing template files** with the updated versions above
2. **Test the new email format**:
   ```bash
   curl -X POST http://localhost:5000/api/email/test-daily
   ```
3. **Verify the sections appear** with real sector and economic data
4. **Test on different devices** and email clients

Your emails will now be a complete replica of your dashboard, including the comprehensive Sector Tracker and Economic Calendar sections, all optimized for mobile viewing!