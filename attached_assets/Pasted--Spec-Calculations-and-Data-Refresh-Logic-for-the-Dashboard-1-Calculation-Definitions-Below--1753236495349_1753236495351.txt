# Spec: Calculations and Data Refresh Logic for the Dashboard

## 1. Calculation Definitions

Below are the methods by which each metric in the table is calculated and updated:

### Metric
- **Definition**: Raw value from the latest release for each indicator.

### Type (Leading, Coincident, Lagging)  
- **Definition**: Classification set per indicator based on economic timing theory.
- **Calculation**: Static assignment (not recalculated).

### Category  
- **Definition**: Thematic grouping, e.g., Growth, Inflation, Policy, Labor, Sentiment.
- **Calculation**: Static assignment (not recalculated).

### Date of Release  
- **Definition**: Official release date of the indicator's data point.
- **Calculation**: Pulled directly from the data provider at time of update.

### Current Reading  
- **Definition**: Most recently published value for the indicator.
- **Calculation**: Pulled from the newest available dataset for each update cycle.

### Forecast  
- **Definition**: Consensus forecast collected prior to indicator release (usually from surveys of economists).
- **Calculation**: Pulled from financial data sources at the time of indicator release.

### Variance vs. Forecast  
- **Definition**: Difference between the current reading and forecast.
- **Formula**:  
  $$
  \text{Variance vs. Forecast} = \text{Current Reading} - \text{Forecast}
  $$

### Prior Reading  
- **Definition**: The previous value reported for the indicator.
- **Calculation**: Pulled from the historical data, referencing the immediately preceding time period for the same indicator.

### Variance vs. Prior Reading  
- **Definition**: Change in the indicator’s value from its prior reading.
- **Formula**:  
  $$
  \text{Variance vs. Prior} = \text{Current Reading} - \text{Prior Reading}
  $$

### Z-Score of Current Move (vs. Last 12 Months)  
- **Definition**: Quantifies how unusual the current monthly move is, compared to the last year of data.
- **Formula**:  
  $$
  \text{Z-Score} = \frac{\text{Current Reading} - \mu_{12M}}{\sigma_{12M}}
  $$  
  - $$\mu_{12M}$$: Mean of indicator values over the prior 12 months
  - $$\sigma_{12M}$$: Standard deviation of values over the prior 12 months

### Three-Month Annualized Rate  
- **Definition**: The average monthly change in the indicator over the past three months, annualized.
- **Steps**:
  1. Compute monthly returns (percentage or absolute, per indicator).
  2. Take the average of these returns over the latest three months.
  3. Annualize:  
      - **For monthly data**:  
        $$
        \text{3M Annualized Rate} = \left(\frac{\text{Sum of Last 3 Monthly Changes}}{3}\right) \times 12
        $$
      - **For quarterly data**:  
        $$
        \text{Quarter Change} \times 4
        $$

### 12-Month (YoY) Change  
- **Definition**: The year-over-year change, comparing latest value to the value one year ago.
- **Formula**:  
  $$
  \text{YoY Change} = \text{Current Reading} - \text{Value 12 Months Ago}
  $$  
  - For rates or indexes reported as percentages, this is often:  
    $$
    \left(\frac{\text{Current Reading}}{\text{Value 12 Months Ago}} - 1\right) \times 100\%
    $$

## 2. Data Refresh & Update Process

### Data Ingestion
- Dashboard is integrated with source APIs or data files (Excel/CSV) for each macroeconomic indicator.
- Update job pulls new releases as they become available on their respective schedules (e.g., monthly, quarterly).

### Historical Data Management
- **Rolling Window**: Maintains at least 13 months of history per indicator to enable YoY and z-score calculations.
- **Data Storage**: Each time series is updated, retaining both current and 12+ months back values.

### Automatic Metric Recalculation

#### Upon Each Data Update:
1. **Insert New Value**: Add the new data point to the historical time series.
2. **Drop Oldest Value**: Remove oldest if storage is limited to 13 months.
3. **Recalculate**: For each indicator:
    - **Prior Reading**: Updated to the value from previous period.
    - **Forecast Variance**: Use new consensus data and latest value.
    - **Z-Score Calculation**: Recompute mean and standard deviation of previous 12 monthly values using updated window.
    - **3M Annualized Rate**: Average last 3 monthly changes, annualize.
    - **12M YoY Change**: Find difference (or percent change) vs. value 12 months ago.
4. **Update Dashboard Visuals**: All cards, tables, and charts are refreshed with the recalculated results.

### Real-Time Display Considerations

- Indicators with different reporting cadences (e.g., weekly, monthly, quarterly) are all stored at their native frequency.
- Missing or forthcoming data is displayed as pending/unavailable until published; last available historical data is retained.

### User Interface Features

- **Manual Refresh**: User can trigger data update (sync with data provider or upload new Excel file).
- **Visual Flags**: Dashboard highlights statistically significant moves (large z-score, surprise vs. forecast) automatically.
- **History Navigation**: Users can drill down on any metric to view its series and historical variances.

## 3. Summary Table: Calculation Methods

| Metric                       | Calculation Logic / Formula                                                        |
|------------------------------|-----------------------------------------------------------------------------------|
| Variance vs. Forecast        | Current Reading – Forecast                                                         |
| Variance vs. Prior Reading   | Current Reading – Prior Reading                                                    |
| Z-Score                      | (Current – 12M Avg) ÷ 12M Std Dev                                                 |
| 3M Annualized Rate           | (3-month Avg Change) × 12                                                          |
| 12M YoY Change               | Current Reading – Value 12 Months Ago (or % change)                               |
| Prior Reading                | Value reported in previous period                                                  |
| Forecast                     | Survey/consensus forecast prior to release                                        |
| Date of Release              | Official indicator release date (from data source)                                |

This approach ensures all metrics are dynamically recalculated each time the data series is updated, supporting robust, real-time macroeconomic dashboarding for traders.